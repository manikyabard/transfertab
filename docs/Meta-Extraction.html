---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/03_Meta-Extraction.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_Meta-Extraction.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.tabular.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">ADULT_SAMPLE</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;adult.csv&#39;</span><span class="p">)</span>
<span class="n">splits1</span> <span class="o">=</span> <span class="n">RandomSplitter</span><span class="p">(</span><span class="n">valid_pct</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">range_of</span><span class="p">(</span><span class="n">df1</span><span class="p">))</span>
<span class="n">to1</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">,</span><span class="n">Normalize</span><span class="p">],</span>
                   <span class="n">cat_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;workclass&#39;</span><span class="p">,</span> <span class="s1">&#39;education&#39;</span><span class="p">,</span> <span class="s1">&#39;marital-status&#39;</span><span class="p">,</span> <span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="s1">&#39;relationship&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">],</span>
                   <span class="n">cont_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;fnlwgt&#39;</span><span class="p">,</span> <span class="s1">&#39;education-num&#39;</span><span class="p">],</span>
                   <span class="n">y_names</span><span class="o">=</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span>
                   <span class="n">splits</span><span class="o">=</span><span class="n">splits1</span><span class="p">)</span>
<span class="n">dls1</span> <span class="o">=</span> <span class="n">to1</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">bs</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">tabular_learner</span><span class="p">(</span><span class="n">dls1</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">extract_meta_from_learner</span><span class="p">(</span><span class="n">learner</span><span class="p">):</span>
    <span class="n">cat_list</span><span class="o">=</span><span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">cat_names</span>
    <span class="c1">#print(cat_list)</span>
    <span class="n">temp_meta</span><span class="o">=</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">cat_list</span><span class="p">)</span>
    <span class="n">t</span><span class="o">=</span><span class="n">learner</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">classes</span>
    <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span><span class="n">cat_list</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">temp_meta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;classes&#39;</span><span class="p">:</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span>
    <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp_meta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">meta</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dictionary</span> <span class="o">=</span> <span class="n">extract_meta_from_learner</span><span class="p">(</span><span class="n">learn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;workclass&#39;, &#39;education&#39;, &#39;marital-status&#39;, &#39;occupation&#39;, &#39;relationship&#39;, &#39;race&#39;, &#39;sex&#39;, &#39;education-num_na&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;categories&#39;: [&#39;workclass&#39;, &#39;education&#39;, &#39;marital-status&#39;, &#39;occupation&#39;, &#39;relationship&#39;, &#39;race&#39;, &#39;sex&#39;, &#39;education-num_na&#39;], &#39;workclass&#39;: {&#39;classes&#39;: [&#39;#na#&#39;, &#39; ?&#39;, &#39; Federal-gov&#39;, &#39; Local-gov&#39;, &#39; Never-worked&#39;, &#39; Private&#39;, &#39; Self-emp-inc&#39;, &#39; Self-emp-not-inc&#39;, &#39; State-gov&#39;, &#39; Without-pay&#39;]}, &#39;education&#39;: {&#39;classes&#39;: [&#39;#na#&#39;, &#39; 10th&#39;, &#39; 11th&#39;, &#39; 12th&#39;, &#39; 1st-4th&#39;, &#39; 5th-6th&#39;, &#39; 7th-8th&#39;, &#39; 9th&#39;, &#39; Assoc-acdm&#39;, &#39; Assoc-voc&#39;, &#39; Bachelors&#39;, &#39; Doctorate&#39;, &#39; HS-grad&#39;, &#39; Masters&#39;, &#39; Preschool&#39;, &#39; Prof-school&#39;, &#39; Some-college&#39;]}, &#39;marital-status&#39;: {&#39;classes&#39;: [&#39;#na#&#39;, &#39; Divorced&#39;, &#39; Married-AF-spouse&#39;, &#39; Married-civ-spouse&#39;, &#39; Married-spouse-absent&#39;, &#39; Never-married&#39;, &#39; Separated&#39;, &#39; Widowed&#39;]}, &#39;occupation&#39;: {&#39;classes&#39;: [&#39;#na#&#39;, &#39; ?&#39;, &#39; Adm-clerical&#39;, &#39; Armed-Forces&#39;, &#39; Craft-repair&#39;, &#39; Exec-managerial&#39;, &#39; Farming-fishing&#39;, &#39; Handlers-cleaners&#39;, &#39; Machine-op-inspct&#39;, &#39; Other-service&#39;, &#39; Priv-house-serv&#39;, &#39; Prof-specialty&#39;, &#39; Protective-serv&#39;, &#39; Sales&#39;, &#39; Tech-support&#39;, &#39; Transport-moving&#39;]}, &#39;relationship&#39;: {&#39;classes&#39;: [&#39;#na#&#39;, &#39; Husband&#39;, &#39; Not-in-family&#39;, &#39; Other-relative&#39;, &#39; Own-child&#39;, &#39; Unmarried&#39;, &#39; Wife&#39;]}, &#39;race&#39;: {&#39;classes&#39;: [&#39;#na#&#39;, &#39; Amer-Indian-Eskimo&#39;, &#39; Asian-Pac-Islander&#39;, &#39; Black&#39;, &#39; Other&#39;, &#39; White&#39;]}, &#39;sex&#39;: {&#39;classes&#39;: [&#39;#na#&#39;, &#39; Female&#39;, &#39; Male&#39;]}, &#39;education-num_na&#39;: {&#39;classes&#39;: [&#39;#na#&#39;, False, True]}}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;adult.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">extract_meta_from_data</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">cat_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
            <span class="n">cat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">cat_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">cat_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_dict</span><span class="p">:</span>
        <span class="n">cat_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        
    <span class="k">return</span> <span class="n">cat_dict</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">extract_meta_from_data</span><span class="p">(</span><span class="s1">&#39;adult.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;workclass&#39;: [&#39; Private&#39;,
  &#39; Self-emp-inc&#39;,
  &#39; Self-emp-not-inc&#39;,
  &#39; State-gov&#39;,
  &#39; Federal-gov&#39;,
  &#39; Local-gov&#39;,
  &#39; ?&#39;,
  &#39; Without-pay&#39;,
  &#39; Never-worked&#39;],
 &#39;education&#39;: [&#39; Assoc-acdm&#39;,
  &#39; Masters&#39;,
  &#39; HS-grad&#39;,
  &#39; Prof-school&#39;,
  &#39; 7th-8th&#39;,
  &#39; Some-college&#39;,
  &#39; 11th&#39;,
  &#39; Bachelors&#39;,
  &#39; Assoc-voc&#39;,
  &#39; 10th&#39;,
  &#39; 9th&#39;,
  &#39; Doctorate&#39;,
  &#39; 12th&#39;,
  &#39; 1st-4th&#39;,
  &#39; 5th-6th&#39;,
  &#39; Preschool&#39;],
 &#39;marital-status&#39;: [&#39; Married-civ-spouse&#39;,
  &#39; Divorced&#39;,
  &#39; Never-married&#39;,
  &#39; Widowed&#39;,
  &#39; Married-spouse-absent&#39;,
  &#39; Separated&#39;,
  &#39; Married-AF-spouse&#39;],
 &#39;occupation&#39;: [nan,
  &#39; Exec-managerial&#39;,
  &#39; Prof-specialty&#39;,
  &#39; Other-service&#39;,
  &#39; Handlers-cleaners&#39;,
  &#39; Craft-repair&#39;,
  &#39; Adm-clerical&#39;,
  &#39; Sales&#39;,
  &#39; Machine-op-inspct&#39;,
  &#39; Transport-moving&#39;,
  &#39; ?&#39;,
  &#39; Farming-fishing&#39;,
  &#39; Tech-support&#39;,
  &#39; Protective-serv&#39;,
  &#39; Priv-house-serv&#39;,
  &#39; Armed-Forces&#39;],
 &#39;relationship&#39;: [&#39; Wife&#39;,
  &#39; Not-in-family&#39;,
  &#39; Unmarried&#39;,
  &#39; Husband&#39;,
  &#39; Own-child&#39;,
  &#39; Other-relative&#39;],
 &#39;race&#39;: [&#39; White&#39;,
  &#39; Black&#39;,
  &#39; Asian-Pac-Islander&#39;,
  &#39; Amer-Indian-Eskimo&#39;,
  &#39; Other&#39;],
 &#39;sex&#39;: [&#39; Female&#39;, &#39; Male&#39;],
 &#39;native-country&#39;: [&#39; United-States&#39;,
  &#39; ?&#39;,
  &#39; Puerto-Rico&#39;,
  &#39; Mexico&#39;,
  &#39; Canada&#39;,
  &#39; Taiwan&#39;,
  &#39; Vietnam&#39;,
  &#39; Philippines&#39;,
  &#39; Germany&#39;,
  &#39; India&#39;,
  &#39; China&#39;,
  &#39; England&#39;,
  &#39; Japan&#39;,
  &#39; Trinadad&amp;Tobago&#39;,
  &#39; Iran&#39;,
  &#39; Guatemala&#39;,
  &#39; Jamaica&#39;,
  &#39; Italy&#39;,
  &#39; Greece&#39;,
  &#39; Cuba&#39;,
  &#39; South&#39;,
  &#39; Dominican-Republic&#39;,
  &#39; Poland&#39;,
  &#39; Hong&#39;,
  &#39; Nicaragua&#39;,
  &#39; Thailand&#39;,
  &#39; Portugal&#39;,
  &#39; Peru&#39;,
  &#39; El-Salvador&#39;,
  &#39; Ecuador&#39;,
  &#39; Ireland&#39;,
  &#39; France&#39;,
  &#39; Yugoslavia&#39;,
  &#39; Hungary&#39;,
  &#39; Scotland&#39;,
  &#39; Holand-Netherlands&#39;,
  &#39; Haiti&#39;,
  &#39; Honduras&#39;,
  &#39; Columbia&#39;,
  &#39; Laos&#39;,
  &#39; Outlying-US(Guam-USVI-etc)&#39;,
  &#39; Cambodia&#39;],
 &#39;salary&#39;: [&#39;&gt;=50k&#39;, &#39;&lt;50k&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

