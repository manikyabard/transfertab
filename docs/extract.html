---

title: Extraction Utilities


keywords: fastai
sidebar: home_sidebar

summary: "Contains helpful functions for extracting embeddings and preparing data for it."
description: "Contains helpful functions for extracting embeddings and preparing data for it."
nb_path: "nbs/01_extract.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_extract.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emb_szs</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embed</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span> <span class="k">for</span> <span class="n">ni</span><span class="p">,</span><span class="n">nf</span> <span class="ow">in</span> <span class="n">emb_szs</span><span class="p">])</span>
<span class="n">embed</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ModuleList(
  (0): Embedding(3, 10)
  (1): Embedding(4, 8)
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="JSONizerWithBool" class="doc_header"><code>class</code> <code>JSONizerWithBool</code><a href="https://github.com/manikyabard/transfertab/tree/master/transfertab/utils.py#L15" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>JSONizerWithBool</code>(<strong><code>skipkeys</code></strong>=<em><code>False</code></em>, <strong><code>ensure_ascii</code></strong>=<em><code>True</code></em>, <strong><code>check_circular</code></strong>=<em><code>True</code></em>, <strong><code>allow_nan</code></strong>=<em><code>True</code></em>, <strong><code>sort_keys</code></strong>=<em><code>False</code></em>, <strong><code>indent</code></strong>=<em><code>None</code></em>, <strong><code>separators</code></strong>=<em><code>None</code></em>, <strong><code>default</code></strong>=<em><code>None</code></em>) :: <code>JSONEncoder</code></p>
</blockquote>

<pre><code>Extensible JSON &lt;http://json.org&gt; encoder for Python data structures.

Supports the following objects and types by default:

+-------------------+---------------+
| Python            | JSON          |
+===================+===============+
| dict              | object        |
+-------------------+---------------+
| list, tuple       | array         |
+-------------------+---------------+
| str               | string        |
+-------------------+---------------+
| int, float        | number        |
+-------------------+---------------+
| True              | true          |
+-------------------+---------------+
| False             | false         |
+-------------------+---------------+
| None              | null          |
+-------------------+---------------+

To extend this to recognize other objects, subclass and implement a
``.default()`` method with another method that returns a serializable
object for ``o`` if possible, otherwise it should call the superclass
implementation (to raise ``TypeError``).</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="getcatdict" class="doc_header"><code>getcatdict</code><a href="https://github.com/manikyabard/transfertab/tree/master/transfertab/utils.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>getcatdict</code>(<strong><code>df</code></strong>, <strong><code>catcols</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="store_bson" class="doc_header"><code>store_bson</code><a href="https://github.com/manikyabard/transfertab/tree/master/transfertab/utils.py#L39" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>store_bson</code>(<strong><code>path</code></strong>, <strong><code>data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_bson" class="doc_header"><code>load_bson</code><a href="https://github.com/manikyabard/transfertab/tree/master/transfertab/utils.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_bson</code>(<strong><code>path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;cat1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="s2">&quot;cat2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="s2">&quot;cat3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]})</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cat1</th>
      <th>cat2</th>
      <th>cat3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>a</td>
      <td>A</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>b</td>
      <td>B</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>c</td>
      <td>C</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>b</td>
      <td>D</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>a</td>
      <td>A</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">catdict</span> <span class="o">=</span> <span class="n">getcatdict</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;cat2&quot;</span><span class="p">,</span> <span class="s2">&quot;cat3&quot;</span><span class="p">))</span>
<span class="n">catdict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;cat2&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], &#39;cat3&#39;: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cats</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;cat2&quot;</span><span class="p">,</span> <span class="s2">&quot;cat3&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embdict</span> <span class="o">=</span> <span class="n">extractembeds</span><span class="p">(</span><span class="n">embed</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">transfercats</span><span class="o">=</span><span class="n">cats</span><span class="p">,</span> <span class="n">allcats</span><span class="o">=</span><span class="n">cats</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;tempwtbson&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bson&quot;</span><span class="p">)</span>
<span class="n">embdict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;cat2&#39;: {&#39;classes&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;],
  &#39;embeddings&#39;: [[0.05603214353322983,
    1.3744007349014282,
    -0.31262442469596863,
    0.37519311904907227,
    -1.9234352111816406,
    0.6861013770103455,
    -1.4775152206420898,
    1.109705924987793,
    0.10772546380758286,
    -1.831138014793396],
   [-0.6345962285995483,
    -1.946880578994751,
    -0.3423684537410736,
    0.04363042116165161,
    0.2794189751148224,
    0.06722379475831985,
    -0.28763726353645325,
    0.9291570782661438,
    0.00894381757825613,
    0.7326543927192688],
   [0.4946509003639221,
    -0.409279465675354,
    0.5394951701164246,
    0.08757159858942032,
    -0.5254548192024231,
    0.6215347647666931,
    -1.835079550743103,
    -1.5779095888137817,
    1.0498842000961304,
    -0.7102258801460266]]},
 &#39;cat3&#39;: {&#39;classes&#39;: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;],
  &#39;embeddings&#39;: [[-0.7851612567901611,
    1.226929783821106,
    -0.7716110944747925,
    0.1601991206407547,
    -0.11754895001649857,
    -1.1803913116455078,
    -0.4639241397380829,
    0.5309280157089233],
   [0.2611830532550812,
    0.40283119678497314,
    0.44922569394111633,
    -1.1285836696624756,
    -0.016770029440522194,
    0.9352428317070007,
    -0.7477204203605652,
    -0.913521409034729],
   [-1.15754234790802,
    -0.7661369442939758,
    0.7403942346572876,
    -0.3353077471256256,
    -1.9750518798828125,
    -0.9902587532997131,
    1.2524845600128174,
    -0.32062724232673645],
   [2.371568202972412,
    -0.7199055552482605,
    0.41099539399147034,
    0.5439063310623169,
    1.0424811840057373,
    1.1662890911102295,
    0.028144370764493942,
    -0.20297423005104065]]}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embdict</span> <span class="o">=</span> <span class="n">extractembeds</span><span class="p">(</span><span class="n">embed</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">transfercats</span><span class="o">=</span><span class="n">cats</span><span class="p">,</span> <span class="n">allcats</span><span class="o">=</span><span class="n">cats</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;tempwtjson&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
<span class="n">embdict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;cat2&#39;: {&#39;classes&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;],
  &#39;embeddings&#39;: [[0.05603214353322983,
    1.3744007349014282,
    -0.31262442469596863,
    0.37519311904907227,
    -1.9234352111816406,
    0.6861013770103455,
    -1.4775152206420898,
    1.109705924987793,
    0.10772546380758286,
    -1.831138014793396],
   [-0.6345962285995483,
    -1.946880578994751,
    -0.3423684537410736,
    0.04363042116165161,
    0.2794189751148224,
    0.06722379475831985,
    -0.28763726353645325,
    0.9291570782661438,
    0.00894381757825613,
    0.7326543927192688],
   [0.4946509003639221,
    -0.409279465675354,
    0.5394951701164246,
    0.08757159858942032,
    -0.5254548192024231,
    0.6215347647666931,
    -1.835079550743103,
    -1.5779095888137817,
    1.0498842000961304,
    -0.7102258801460266]]},
 &#39;cat3&#39;: {&#39;classes&#39;: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;],
  &#39;embeddings&#39;: [[-0.7851612567901611,
    1.226929783821106,
    -0.7716110944747925,
    0.1601991206407547,
    -0.11754895001649857,
    -1.1803913116455078,
    -0.4639241397380829,
    0.5309280157089233],
   [0.2611830532550812,
    0.40283119678497314,
    0.44922569394111633,
    -1.1285836696624756,
    -0.016770029440522194,
    0.9352428317070007,
    -0.7477204203605652,
    -0.913521409034729],
   [-1.15754234790802,
    -0.7661369442939758,
    0.7403942346572876,
    -0.3353077471256256,
    -1.9750518798828125,
    -0.9902587532997131,
    1.2524845600128174,
    -0.32062724232673645],
   [2.371568202972412,
    -0.7199055552482605,
    0.41099539399147034,
    0.5439063310623169,
    1.0424811840057373,
    1.1662890911102295,
    0.028144370764493942,
    -0.20297423005104065]]}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">load_bson</span><span class="p">(</span><span class="s2">&quot;tempwtbson&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">embdict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;tempwtbson&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;tempwtjson&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

