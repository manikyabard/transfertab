---

title: Core (Archived)


keywords: fastai
sidebar: home_sidebar

summary: "Conatains methods for transferring."
description: "Conatains methods for transferring."
nb_path: "nbs/01_oldtransfer.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_oldtransfer.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai.tabular.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">transfertab.utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">json</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">ADULT_SAMPLE</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;adult.csv&#39;</span><span class="p">)</span>
<span class="n">splits1</span> <span class="o">=</span> <span class="n">RandomSplitter</span><span class="p">(</span><span class="n">valid_pct</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">range_of</span><span class="p">(</span><span class="n">df1</span><span class="p">))</span>
<span class="n">to1</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">,</span><span class="n">Normalize</span><span class="p">],</span>
                   <span class="n">cat_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;workclass&#39;</span><span class="p">,</span> <span class="s1">&#39;education&#39;</span><span class="p">,</span> <span class="s1">&#39;marital-status&#39;</span><span class="p">,</span> <span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="s1">&#39;relationship&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">],</span>
                   <span class="n">cont_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;fnlwgt&#39;</span><span class="p">,</span> <span class="s1">&#39;education-num&#39;</span><span class="p">],</span>
                   <span class="n">y_names</span><span class="o">=</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span>
                   <span class="n">splits</span><span class="o">=</span><span class="n">splits1</span><span class="p">)</span>
<span class="n">dls1</span> <span class="o">=</span> <span class="n">to1</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">bs</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
<span class="n">learn1</span> <span class="o">=</span> <span class="n">tabular_learner</span><span class="p">(</span><span class="n">dls1</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn1</span><span class="o">.</span><span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>TabularModel(
  (embeds): ModuleList(
    (0): Embedding(10, 6)
    (1): Embedding(17, 8)
    (2): Embedding(8, 5)
    (3): Embedding(16, 8)
    (4): Embedding(7, 5)
    (5): Embedding(6, 4)
    (6): Embedding(3, 3)
    (7): Embedding(3, 3)
  )
  (emb_drop): Dropout(p=0.0, inplace=False)
  (bn_cont): BatchNorm1d(3, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (layers): Sequential(
    (0): LinBnDrop(
      (0): Linear(in_features=45, out_features=200, bias=False)
      (1): ReLU(inplace=True)
      (2): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
    (1): LinBnDrop(
      (0): Linear(in_features=200, out_features=100, bias=False)
      (1): ReLU(inplace=True)
      (2): BatchNorm1d(100, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
    (2): LinBnDrop(
      (0): Linear(in_features=100, out_features=2, bias=True)
    )
  )
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Aim is to take these embeddings and transfer them to other models</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))[:,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([1, 1])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">catinp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">continp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn1</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">learn1</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(Parameter containing:
 tensor([[-5.6853e-03,  1.8688e-03,  1.4476e-02,  9.7890e-03,  1.4115e-02,
           5.7125e-03],
         [-9.1271e-03, -1.5946e-03,  5.6058e-03,  3.0356e-03,  2.5559e-03,
          -1.2680e-02],
         [-2.1623e-03, -4.1510e-05, -1.0180e-02,  1.3648e-02,  1.5476e-02,
          -1.8098e-03],
         [ 5.6572e-03,  1.5083e-02,  7.9600e-03, -7.3476e-04, -1.1631e-02,
          -7.4402e-03],
         [ 3.3497e-03, -3.0329e-03,  2.3689e-03, -3.3820e-03,  1.5509e-02,
          -9.7973e-03],
         [ 1.2162e-02,  1.0208e-02,  1.4835e-03,  8.3532e-03,  1.1189e-02,
           9.2965e-04],
         [ 8.5163e-03, -1.2888e-02,  8.2518e-03,  3.5525e-03,  4.3668e-03,
           3.4388e-03],
         [ 6.6009e-03, -5.5191e-03,  7.2820e-03,  1.3600e-02, -2.4659e-03,
          -6.2848e-04],
         [ 1.0715e-03, -3.1847e-03, -6.2840e-03, -6.0915e-03,  7.6644e-04,
           4.6805e-03],
         [ 1.5399e-02, -8.3873e-03, -8.9908e-03,  3.5097e-04, -7.0670e-03,
           1.1123e-02]], requires_grad=True),
 torch.Size([10, 6]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.371636</td>
      <td>0.351842</td>
      <td>0.838298</td>
      <td>00:04</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_rows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">49</span><span class="p">,</span><span class="s1">&#39;Private&#39;</span><span class="p">,</span><span class="mi">101320</span><span class="p">,</span><span class="s1">&#39;Assoc-acdm&#39;</span><span class="p">,</span><span class="mf">12.0</span><span class="p">,</span><span class="s1">&#39;Married-civ-spouse&#39;</span><span class="p">,</span><span class="s1">&#39;Exec-managerial&#39;</span><span class="p">,</span><span class="s1">&#39;Wife&#39;</span><span class="p">,</span><span class="s1">&#39;Robot&#39;</span><span class="p">,</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1902</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="s1">&#39;United-States&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;=50k&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="s1">&#39;Private&#39;</span><span class="p">,</span><span class="mi">182308</span><span class="p">,</span><span class="s1">&#39;Bachelors&#39;</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="s1">&#39;Never-married&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">,</span><span class="s1">&#39;Own-child&#39;</span><span class="p">,</span><span class="s1">&#39;Other&#39;</span><span class="p">,</span><span class="s1">&#39;Male&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="s1">&#39;United-States&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;50k&#39;</span><span class="p">]],</span>
                        <span class="n">columns</span><span class="o">=</span><span class="n">df1</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rows</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>fnlwgt</th>
      <th>education</th>
      <th>education-num</th>
      <th>marital-status</th>
      <th>occupation</th>
      <th>relationship</th>
      <th>race</th>
      <th>sex</th>
      <th>capital-gain</th>
      <th>capital-loss</th>
      <th>hours-per-week</th>
      <th>native-country</th>
      <th>salary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>32558</th>
      <td>53</td>
      <td>Private</td>
      <td>157069</td>
      <td>Assoc-acdm</td>
      <td>12.0</td>
      <td>Married-civ-spouse</td>
      <td>Machine-op-inspct</td>
      <td>Husband</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&gt;=50k</td>
    </tr>
    <tr>
      <th>32559</th>
      <td>32</td>
      <td>Local-gov</td>
      <td>217296</td>
      <td>HS-grad</td>
      <td>9.0</td>
      <td>Married-civ-spouse</td>
      <td>Transport-moving</td>
      <td>Wife</td>
      <td>White</td>
      <td>Female</td>
      <td>4064</td>
      <td>0</td>
      <td>22</td>
      <td>United-States</td>
      <td>&lt;50k</td>
    </tr>
    <tr>
      <th>32560</th>
      <td>26</td>
      <td>Private</td>
      <td>182308</td>
      <td>Some-college</td>
      <td>10.0</td>
      <td>Married-civ-spouse</td>
      <td>Prof-specialty</td>
      <td>Husband</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;50k</td>
    </tr>
    <tr>
      <th>32561</th>
      <td>49</td>
      <td>Private</td>
      <td>101320</td>
      <td>Assoc-acdm</td>
      <td>12.0</td>
      <td>Married-civ-spouse</td>
      <td>Exec-managerial</td>
      <td>Wife</td>
      <td>Robot</td>
      <td>Female</td>
      <td>0</td>
      <td>1902</td>
      <td>40</td>
      <td>United-States</td>
      <td>&gt;=50k</td>
    </tr>
    <tr>
      <th>32562</th>
      <td>18</td>
      <td>Private</td>
      <td>182308</td>
      <td>Bachelors</td>
      <td>10.0</td>
      <td>Never-married</td>
      <td>?</td>
      <td>Own-child</td>
      <td>Other</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>23</td>
      <td>United-States</td>
      <td>&lt;50k</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">splits2</span> <span class="o">=</span> <span class="n">RandomSplitter</span><span class="p">(</span><span class="n">valid_pct</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">range_of</span><span class="p">(</span><span class="n">df2</span><span class="p">))</span>
<span class="n">to2</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">,</span><span class="n">Normalize</span><span class="p">],</span>
                   <span class="n">cat_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;workclass&#39;</span><span class="p">,</span> <span class="s1">&#39;education&#39;</span><span class="p">,</span> <span class="s1">&#39;marital-status&#39;</span><span class="p">,</span> <span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="s1">&#39;relationship&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">],</span>
                   <span class="n">cont_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;fnlwgt&#39;</span><span class="p">,</span> <span class="s1">&#39;education-num&#39;</span><span class="p">],</span>
                   <span class="n">y_names</span><span class="o">=</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span>
                   <span class="n">splits</span><span class="o">=</span><span class="n">splits2</span><span class="p">)</span>
<span class="n">dls2</span> <span class="o">=</span> <span class="n">to2</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">bs</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
<span class="n">learn2</span> <span class="o">=</span> <span class="n">tabular_learner</span><span class="p">(</span><span class="n">dls2</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ModuleList(
  (0): Embedding(11, 6)
  (1): Embedding(19, 8)
  (2): Embedding(10, 6)
  (3): Embedding(18, 8)
  (4): Embedding(9, 5)
  (5): Embedding(8, 5)
  (6): Embedding(5, 4)
  (7): Embedding(3, 3)
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TabTransfer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_learner</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_cat_names</span> <span class="o">=</span> <span class="n">new_learner</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">cat_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_all_classes</span> <span class="o">=</span> <span class="n">new_learner</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span> <span class="o">=</span> <span class="n">new_learner</span>
        
    <span class="k">def</span> <span class="nf">init_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        `path` can either a json file or a directory containing multiple json files.</span>
<span class="sd">        The json should contain </span>
<span class="sd">            a `categories` key with all the categories in that json, </span>
<span class="sd">            a key for each category in `categories` inside which there should be</span>
<span class="sd">                a `classes` key with all classes of that key</span>
<span class="sd">                an `embeddings` key with the embeddings for that category</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">json_file</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span> 
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
            <span class="n">json_file</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">json_file</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;categories&quot;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="k">for</span> <span class="n">json_f</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.json&quot;</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_f</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">json_file</span><span class="p">[</span><span class="s2">&quot;categories&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;categories&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;categories&quot;</span><span class="p">]</span>
                <span class="n">json_file</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_cat_names</span> <span class="o">=</span> <span class="n">json_file</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]</span>
        <span class="n">classes_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_cat_names</span><span class="p">)</span>
        <span class="n">embed_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_cat_names</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_cat_names</span><span class="p">:</span>
            <span class="n">classes_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_file</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span>
            <span class="n">embed_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_file</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;embeddings&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_all_classes</span> <span class="o">=</span> <span class="n">classes_dict</span> <span class="c1"># contains the cat variable with all its classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_all_embeds</span> <span class="o">=</span> <span class="n">embed_dict</span> <span class="c1"># contains the cat variable with all its embeddings</span>
        
    <span class="k">def</span> <span class="nf">mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat_names_to_transfer</span><span class="p">):</span>
        <span class="n">mapping_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">cat_names_to_transfer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">curr_cat</span> <span class="ow">in</span> <span class="n">cat_names_to_transfer</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">curr_cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_cat_names</span> <span class="ow">and</span> <span class="n">curr_cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_cat_names</span><span class="p">):</span>
                <span class="n">mapping_dict</span><span class="p">[</span><span class="n">curr_cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">curr_cat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_cat_names</span><span class="p">)</span>
                <span class="n">mapping_cat</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">What do you want to map </span><span class="si">{</span><span class="n">curr_cat</span><span class="si">}</span><span class="s2"> to : </span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">mapping_dict</span><span class="p">[</span><span class="n">curr_cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping_cat</span>
        <span class="k">return</span> <span class="n">mapping_dict</span>
                
        
    <span class="k">def</span> <span class="nf">transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat_names_to_transfer</span><span class="p">,</span> <span class="n">layergroup</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">curr_cat</span> <span class="ow">in</span> <span class="n">cat_names_to_transfer</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">curr_cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_cat_names</span> <span class="ow">and</span> <span class="n">curr_cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_cat_names</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">old_cat_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_cat_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">curr_cat</span><span class="p">)</span>
            <span class="n">new_cat_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_cat_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">curr_cat</span><span class="p">)</span>
            
            <span class="c1"># TODO: Make it so that this isn&#39;t required by taking care of this.</span>
            <span class="k">try</span><span class="p">:</span> <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tabobj</span><span class="o">.</span><span class="n">old_all_embeds</span><span class="p">[</span><span class="n">curr_cat</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">layergroup</span><span class="p">)[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">embedding_dim</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encountered an error for variable </span><span class="si">{</span><span class="n">curr_cat</span><span class="si">}</span><span class="s2">: Make sure embeddings dimensions are same for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">old_all_embeds</span><span class="p">[</span><span class="n">curr_cat</span><span class="p">]</span><span class="si">}</span><span class="s2"> with size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tabobj</span><span class="o">.</span><span class="n">old_all_embeds</span><span class="p">[</span><span class="n">curr_cat</span><span class="p">])</span><span class="si">}</span><span class="s2">, and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="si">}</span><span class="s2"> with size </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">embedding_dim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moving on to other cat vars&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            
            <span class="n">old_curr_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_all_classes</span><span class="p">[</span><span class="n">curr_cat</span><span class="p">]</span>
            <span class="n">new_curr_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_all_classes</span><span class="p">[</span><span class="n">curr_cat</span><span class="p">]</span>
            
            <span class="n">torch_embeds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_all_embeds</span><span class="p">[</span><span class="n">curr_cat</span><span class="p">])</span>
            <span class="n">weights_mean</span> <span class="o">=</span> <span class="n">torch_embeds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mean is </span><span class="si">{</span><span class="n">weights_mean</span><span class="si">}</span><span class="s1"> for </span><span class="si">{</span><span class="n">torch_embeds</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Case where some class in old, but not in new isn&#39;t being handled rn.</span>

            <span class="k">for</span> <span class="n">new_curr_class</span> <span class="ow">in</span> <span class="n">new_curr_classes</span><span class="p">:</span>
                <span class="n">new_curr_class_idx</span> <span class="o">=</span> <span class="n">new_curr_classes</span><span class="o">.</span><span class="n">o2i</span><span class="p">[</span><span class="n">new_curr_class</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_curr_class_idx</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">new_curr_class_idx</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">new_curr_class</span> <span class="ow">in</span> <span class="n">old_curr_classes</span><span class="p">:</span>
                    <span class="n">old_curr_class_idx</span> <span class="o">=</span> <span class="n">old_curr_classes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_curr_class</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Transferring weights for class </span><span class="si">{</span><span class="n">new_curr_class</span><span class="si">}</span><span class="s1">, cat </span><span class="si">{</span><span class="n">curr_cat</span><span class="si">}</span><span class="s1"> from previous weights&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;old weight for class is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">tempwgt1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="n">tempwgt2</span> <span class="o">=</span> <span class="n">torch_embeds</span><span class="p">[</span><span class="n">old_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">torch_embeds</span><span class="p">[</span><span class="n">old_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">required_grad</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new weight for class is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Transferring weights for class </span><span class="si">{</span><span class="n">new_curr_class</span><span class="si">}</span><span class="s1">, cat </span><span class="si">{</span><span class="n">curr_cat</span><span class="si">}</span><span class="s1"> using mean&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;old weight for class is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">weights_mean</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">required_grad</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new weight for class is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">new_learner</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">new_cat_idx</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">new_curr_class_idx</span><span class="p">,</span> <span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tabobj</span> <span class="o">=</span> <span class="n">TabTransfer</span><span class="p">(</span><span class="n">learn1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tabobj</span><span class="o">.</span><span class="n">init_from_json</span><span class="p">(</span><span class="s2">&quot;../data/adults.json&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tabobj</span><span class="o">.</span><span class="n">old_cat_names</span><span class="p">,</span> <span class="n">tabobj</span><span class="o">.</span><span class="n">old_all_classes</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>([&#39;workclass&#39;,
  &#39;education&#39;,
  &#39;marital-status&#39;,
  &#39;occupation&#39;,
  &#39;relationship&#39;,
  &#39;race&#39;,
  &#39;sex&#39;],
 {&#39;workclass&#39;: [&#39;nan&#39;,
   &#39; Private&#39;,
   &#39; Self-emp-inc&#39;,
   &#39; Self-emp-not-inc&#39;,
   &#39; State-gov&#39;,
   &#39; Federal-gov&#39;,
   &#39; Local-gov&#39;,
   &#39; ?&#39;,
   &#39; Without-pay&#39;,
   &#39; Never-worked&#39;],
  &#39;education&#39;: [&#39;nan&#39;,
   &#39; Assoc-acdm&#39;,
   &#39; Masters&#39;,
   &#39; HS-grad&#39;,
   &#39; Prof-school&#39;,
   &#39; 7th-8th&#39;,
   &#39; Some-college&#39;,
   &#39; 11th&#39;,
   &#39; Bachelors&#39;,
   &#39; Assoc-voc&#39;,
   &#39; 10th&#39;,
   &#39; 9th&#39;,
   &#39; Doctorate&#39;,
   &#39; 12th&#39;,
   &#39; 1st-4th&#39;,
   &#39; 5th-6th&#39;,
   &#39; Preschool&#39;],
  &#39;marital-status&#39;: [&#39;nan&#39;,
   &#39; Married-civ-spouse&#39;,
   &#39; Divorced&#39;,
   &#39; Never-married&#39;,
   &#39; Widowed&#39;,
   &#39; Married-spouse-absent&#39;,
   &#39; Separated&#39;,
   &#39; Married-AF-spouse&#39;],
  &#39;occupation&#39;: [&#39;nan&#39;,
   &#39; Exec-managerial&#39;,
   &#39; Prof-specialty&#39;,
   &#39; Other-service&#39;,
   &#39; Handlers-cleaners&#39;,
   &#39; Craft-repair&#39;,
   &#39; Adm-clerical&#39;,
   &#39; Sales&#39;,
   &#39; Machine-op-inspct&#39;,
   &#39; Transport-moving&#39;,
   &#39; ?&#39;,
   &#39; Farming-fishing&#39;,
   &#39; Tech-support&#39;,
   &#39; Protective-serv&#39;,
   &#39; Priv-house-serv&#39;,
   &#39; Armed-Forces&#39;],
  &#39;relationship&#39;: [&#39;nan&#39;,
   &#39; Wife&#39;,
   &#39; Not-in-family&#39;,
   &#39; Unmarried&#39;,
   &#39; Husband&#39;,
   &#39; Own-child&#39;,
   &#39; Other-relative&#39;],
  &#39;race&#39;: [&#39;nan&#39;,
   &#39; White&#39;,
   &#39; Black&#39;,
   &#39; Asian-Pac-Islander&#39;,
   &#39; Amer-Indian-Eskimo&#39;,
   &#39; Other&#39;],
  &#39;sex&#39;: [&#39;Female&#39;, &#39;Male&#39;, &#39;nan&#39;]})</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mapping_dict</span> <span class="o">=</span> <span class="n">tabobj</span><span class="o">.</span><span class="n">mapping</span><span class="p">([</span><span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;workclass&quot;</span><span class="p">,</span> <span class="s2">&quot;gender&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;workclass&#39;, &#39;education&#39;, &#39;marital-status&#39;, &#39;occupation&#39;, &#39;relationship&#39;, &#39;race&#39;, &#39;sex&#39;, &#39;education-num_na&#39;]

What do you want to map gender to : 
sex
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tabobj</span><span class="o">.</span><span class="n">transfer</span><span class="p">([</span><span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;workclass&quot;</span><span class="p">,</span> <span class="s2">&quot;gender&quot;</span><span class="p">],</span> <span class="s2">&quot;embeds&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;race&quot;</span><span class="p">:</span><span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;workclass&quot;</span><span class="p">:</span> <span class="s2">&quot;workclass&quot;</span><span class="p">,</span> <span class="s2">&quot;gender&quot;</span><span class="p">:</span><span class="s2">&quot;sex&quot;</span><span class="p">},</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>mean is tensor([ 0.0026,  0.0024, -0.0051, -0.0007]) for tensor([[ 0.0006, -0.0192, -0.0002,  0.0069],
        [ 0.0045,  0.0120, -0.0178, -0.0027],
        [-0.0107,  0.0151,  0.0019,  0.0083],
        [ 0.0127,  0.0003, -0.0127, -0.0057],
        [ 0.0130,  0.0087, -0.0119, -0.0109],
        [-0.0043, -0.0026,  0.0104,  0.0002]])
0, &lt;class &#39;int&#39;&gt;
Transferring weights for class #na#, cat race using mean
old weight for class is tensor([ 0.0026,  0.0024, -0.0051, -0.0007], grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([ 0.0026,  0.0024, -0.0051, -0.0007], grad_fn=&lt;SliceBackward&gt;)
1, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Amer-Indian-Eskimo, cat race from previous weights
old weight for class is tensor([ 0.0130,  0.0087, -0.0119, -0.0109], grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([ 0.0130,  0.0087, -0.0119, -0.0109], grad_fn=&lt;SliceBackward&gt;)
2, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Asian-Pac-Islander, cat race from previous weights
old weight for class is tensor([ 0.0127,  0.0003, -0.0127, -0.0057], grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([ 0.0127,  0.0003, -0.0127, -0.0057], grad_fn=&lt;SliceBackward&gt;)
3, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Black, cat race from previous weights
old weight for class is tensor([-0.0107,  0.0151,  0.0019,  0.0083], grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0107,  0.0151,  0.0019,  0.0083], grad_fn=&lt;SliceBackward&gt;)
4, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Other, cat race from previous weights
old weight for class is tensor([-0.0043, -0.0026,  0.0104,  0.0002], grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0043, -0.0026,  0.0104,  0.0002], grad_fn=&lt;SliceBackward&gt;)
5, &lt;class &#39;int&#39;&gt;
Transferring weights for class  White, cat race from previous weights
old weight for class is tensor([ 0.0045,  0.0120, -0.0178, -0.0027], grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([ 0.0045,  0.0120, -0.0178, -0.0027], grad_fn=&lt;SliceBackward&gt;)
mean is tensor([-0.0037,  0.0010,  0.0023, -0.0002,  0.0015, -0.0044]) for tensor([[-0.0180, -0.0069, -0.0058,  0.0086, -0.0036,  0.0049],
        [-0.0118,  0.0195, -0.0016,  0.0066,  0.0025,  0.0058],
        [-0.0042, -0.0001, -0.0079, -0.0074,  0.0128, -0.0007],
        [-0.0100, -0.0015,  0.0043, -0.0076,  0.0196, -0.0014],
        [-0.0023, -0.0014,  0.0021,  0.0170,  0.0034, -0.0174],
        [-0.0013,  0.0109,  0.0198,  0.0046,  0.0003, -0.0055],
        [ 0.0095, -0.0083, -0.0071, -0.0034, -0.0135,  0.0102],
        [-0.0009,  0.0011,  0.0071,  0.0015, -0.0078, -0.0169],
        [-0.0056,  0.0022,  0.0066, -0.0191, -0.0044, -0.0085],
        [ 0.0073, -0.0056,  0.0053, -0.0023,  0.0058, -0.0141]])
0, &lt;class &#39;int&#39;&gt;
Transferring weights for class #na#, cat workclass using mean
old weight for class is tensor([-0.0037,  0.0010,  0.0023, -0.0002,  0.0015, -0.0044],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0037,  0.0010,  0.0023, -0.0002,  0.0015, -0.0044],
       grad_fn=&lt;SliceBackward&gt;)
1, &lt;class &#39;int&#39;&gt;
Transferring weights for class  ?, cat workclass from previous weights
old weight for class is tensor([-0.0009,  0.0011,  0.0071,  0.0015, -0.0078, -0.0169],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0009,  0.0011,  0.0071,  0.0015, -0.0078, -0.0169],
       grad_fn=&lt;SliceBackward&gt;)
2, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Federal-gov, cat workclass from previous weights
old weight for class is tensor([-0.0013,  0.0109,  0.0198,  0.0046,  0.0003, -0.0055],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0013,  0.0109,  0.0198,  0.0046,  0.0003, -0.0055],
       grad_fn=&lt;SliceBackward&gt;)
3, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Local-gov, cat workclass from previous weights
old weight for class is tensor([ 0.0095, -0.0083, -0.0071, -0.0034, -0.0135,  0.0102],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([ 0.0095, -0.0083, -0.0071, -0.0034, -0.0135,  0.0102],
       grad_fn=&lt;SliceBackward&gt;)
4, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Never-worked, cat workclass from previous weights
old weight for class is tensor([ 0.0073, -0.0056,  0.0053, -0.0023,  0.0058, -0.0141],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([ 0.0073, -0.0056,  0.0053, -0.0023,  0.0058, -0.0141],
       grad_fn=&lt;SliceBackward&gt;)
5, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Private, cat workclass from previous weights
old weight for class is tensor([-0.0118,  0.0195, -0.0016,  0.0066,  0.0025,  0.0058],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0118,  0.0195, -0.0016,  0.0066,  0.0025,  0.0058],
       grad_fn=&lt;SliceBackward&gt;)
6, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Self-emp-inc, cat workclass from previous weights
old weight for class is tensor([-0.0042, -0.0001, -0.0079, -0.0074,  0.0128, -0.0007],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0042, -0.0001, -0.0079, -0.0074,  0.0128, -0.0007],
       grad_fn=&lt;SliceBackward&gt;)
7, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Self-emp-not-inc, cat workclass from previous weights
old weight for class is tensor([-0.0100, -0.0015,  0.0043, -0.0076,  0.0196, -0.0014],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0100, -0.0015,  0.0043, -0.0076,  0.0196, -0.0014],
       grad_fn=&lt;SliceBackward&gt;)
8, &lt;class &#39;int&#39;&gt;
Transferring weights for class  State-gov, cat workclass from previous weights
old weight for class is tensor([-0.0023, -0.0014,  0.0021,  0.0170,  0.0034, -0.0174],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0023, -0.0014,  0.0021,  0.0170,  0.0034, -0.0174],
       grad_fn=&lt;SliceBackward&gt;)
9, &lt;class &#39;int&#39;&gt;
Transferring weights for class  Without-pay, cat workclass from previous weights
old weight for class is tensor([-0.0056,  0.0022,  0.0066, -0.0191, -0.0044, -0.0085],
       grad_fn=&lt;SliceBackward&gt;)
new weight for class is tensor([-0.0056,  0.0022,  0.0066, -0.0191, -0.0044, -0.0085],
       grad_fn=&lt;SliceBackward&gt;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

