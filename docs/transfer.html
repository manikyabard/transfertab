---

title: Transfer


keywords: fastai
sidebar: home_sidebar

summary: "Contains methods for transferring."
description: "Contains methods for transferring."
nb_path: "nbs/02_transfer.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_transfer.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll create collections of Embedding layers, which will be used to test our transfer methods.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emb_szs1</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">emb_szs2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embed1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span> <span class="k">for</span> <span class="n">ni</span><span class="p">,</span><span class="n">nf</span> <span class="ow">in</span> <span class="n">emb_szs1</span><span class="p">])</span>
<span class="n">embed2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span> <span class="k">for</span> <span class="n">ni</span><span class="p">,</span><span class="n">nf</span> <span class="ow">in</span> <span class="n">emb_szs2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embed1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ModuleList(
  (0): Embedding(3, 10)
  (1): Embedding(2, 8)
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we'll create collections containing required metadata.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newcatcols</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;new_cat1&quot;</span><span class="p">,</span> <span class="s2">&quot;new_cat2&quot;</span><span class="p">)</span>
<span class="n">oldcatcols</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;old_cat1&quot;</span><span class="p">,</span> <span class="s2">&quot;old_cat2&quot;</span><span class="p">)</span>

<span class="n">newcatdict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;new_cat1&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;new_class1&quot;</span><span class="p">,</span> <span class="s2">&quot;new_class2&quot;</span><span class="p">,</span> <span class="s2">&quot;new_class3&quot;</span><span class="p">],</span> <span class="s2">&quot;new_cat2&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;new_class1&quot;</span><span class="p">,</span> <span class="s2">&quot;new_class2&quot;</span><span class="p">]}</span>
<span class="n">oldcatdict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;old_cat1&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;old_class1&quot;</span><span class="p">,</span> <span class="s2">&quot;old_class2&quot;</span><span class="p">],</span> <span class="s2">&quot;old_cat2&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;old_class1&quot;</span><span class="p">,</span> <span class="s2">&quot;old_class2&quot;</span><span class="p">]}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">json_file_path</span> <span class="o">=</span> <span class="s2">&quot;../data/jsons/metadict.json&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">j</span><span class="p">:</span>
     <span class="n">metadict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>metadict</code> is a <code>Dict</code> with the keys as the classes in dest. model's data, and value is another <code>Dict</code> where <code>mapped_cat</code> corresponds to the class in src model's data, along with information about how the classes map from dest. data to src data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metadict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;new_cat1&#39;: {&#39;mapped_cat&#39;: &#39;old_cat1&#39;,
  &#39;classes_info&#39;: {&#39;new_class1&#39;: [&#39;old_class1&#39;, &#39;old_class2&#39;],
   &#39;new_class2&#39;: [&#39;old_class2&#39;],
   &#39;new_class3&#39;: []}},
 &#39;new_cat2&#39;: {&#39;mapped_cat&#39;: &#39;old_cat2&#39;,
  &#39;classes_info&#39;: {&#39;new_class1&#39;: [&#39;old_class2&#39;], &#39;new_class2&#39;: []}}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>pathlib.PosixPath</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Embeddings before transfer:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embed1</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([(&#39;0.weight&#39;,
              tensor([[-0.8785, -1.3125, -1.7447, -0.0523,  0.2181, -0.4410, -0.2545, -0.7003,
                        0.8835,  0.1169],
                      [-0.2754,  1.6872, -1.4758, -0.6321, -0.8176, -0.5889, -0.7625,  1.1944,
                       -0.8908,  0.4763],
                      [ 0.8055,  1.6962,  0.7415, -0.9416, -0.4558,  0.3970,  1.4989, -0.2572,
                       -0.4770,  0.9706]])),
             (&#39;1.weight&#39;,
              tensor([[ 0.5748, -2.2568, -0.1955,  0.1461,  0.8718,  1.2307, -0.3835, -1.2792],
                      [ 0.5399, -0.0471, -0.5947,  0.3210, -0.7245, -0.3612, -1.4094, -0.8337]]))])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embed2</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([(&#39;0.weight&#39;,
              tensor([[-0.8082,  0.0527, -0.4755, -0.2601, -1.5288, -1.4793, -1.2562,  1.7078,
                        1.3433,  0.1644],
                      [ 1.3142, -0.0689,  0.1832,  0.2934,  0.7709,  1.2324, -0.8176, -0.2325,
                        1.6991, -1.1931]])),
             (&#39;1.weight&#39;,
              tensor([[-0.3152,  1.4867, -2.0957, -1.1404,  1.4763,  0.9344, -0.2639, -1.7845],
                      [ 1.3346,  1.3075, -0.7350,  0.4069, -1.7279, -1.3855,  0.3464,  0.1231]]))])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">transfer_cats</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;new_cat1&quot;</span><span class="p">,</span> <span class="s2">&quot;new_cat2&quot;</span><span class="p">)</span>
<span class="n">transferembeds_</span><span class="p">(</span><span class="n">embed1</span><span class="p">,</span> <span class="n">embed2</span><span class="p">,</span> <span class="n">metadict</span><span class="p">,</span> <span class="n">transfer_cats</span><span class="p">,</span> <span class="n">newcatcols</span><span class="o">=</span><span class="n">newcatcols</span><span class="p">,</span> <span class="n">oldcatcols</span><span class="o">=</span><span class="n">oldcatcols</span><span class="p">,</span> <span class="n">oldcatdict</span><span class="o">=</span><span class="n">oldcatdict</span><span class="p">,</span> <span class="n">newcatdict</span><span class="o">=</span><span class="n">newcatdict</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>new param size: torch.Size([10, 3])
old param size: torch.Size([3, 10])

new param size: torch.Size([8, 2])
old param size: torch.Size([2, 8])

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Embeddings after transfer:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embed1</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([(&#39;0.weight&#39;,
              tensor([[ 0.2530, -0.0081, -0.1462,  0.0167, -0.3789, -0.1234, -1.0369,  0.7377,
                        1.5212, -0.5143],
                      [ 1.3142, -0.0689,  0.1832,  0.2934,  0.7709,  1.2324, -0.8176, -0.2325,
                        1.6991, -1.1931],
                      [ 0.2530, -0.0081, -0.1462,  0.0167, -0.3789, -0.1234, -1.0369,  0.7377,
                        1.5212, -0.5143]])),
             (&#39;1.weight&#39;,
              tensor([[ 1.3346,  1.3075, -0.7350,  0.4069, -1.7279, -1.3855,  0.3464,  0.1231],
                      [ 0.5097,  1.3971, -1.4153, -0.3668, -0.1258, -0.2256,  0.0412, -0.8307]]))])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embed2</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>OrderedDict([(&#39;0.weight&#39;,
              tensor([[-0.8082,  0.0527, -0.4755, -0.2601, -1.5288, -1.4793, -1.2562,  1.7078,
                        1.3433,  0.1644],
                      [ 1.3142, -0.0689,  0.1832,  0.2934,  0.7709,  1.2324, -0.8176, -0.2325,
                        1.6991, -1.1931]])),
             (&#39;1.weight&#39;,
              tensor([[-0.3152,  1.4867, -2.0957, -1.1404,  1.4763,  0.9344, -0.2639, -1.7845],
                      [ 1.3346,  1.3075, -0.7350,  0.4069, -1.7279, -1.3855,  0.3464,  0.1231]]))])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

