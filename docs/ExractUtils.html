---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/00_ExractUtils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_ExractUtils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll create a fastai learner, and extract embeddings from it. But it will be possible to do so for any pytorch model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">ADULT_SAMPLE</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;adult.csv&#39;</span><span class="p">)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">TabularDataLoaders</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;adult.csv&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">y_names</span><span class="o">=</span><span class="s2">&quot;salary&quot;</span><span class="p">,</span>
    <span class="n">cat_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;workclass&#39;</span><span class="p">,</span> <span class="s1">&#39;education&#39;</span><span class="p">,</span> <span class="s1">&#39;marital-status&#39;</span><span class="p">,</span> <span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="s1">&#39;relationship&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">],</span>
    <span class="n">cont_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;fnlwgt&#39;</span><span class="p">,</span> <span class="s1">&#39;education-num&#39;</span><span class="p">],</span>
    <span class="n">procs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">,</span> <span class="n">Normalize</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">tabular_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll need to create a metadata dictionary for the source data which contains all the categories, and the classes for each category in the given format.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;categories&quot;</span><span class="p">:[</span><span class="s1">&#39;workclass&#39;</span><span class="p">,</span> <span class="s1">&#39;education&#39;</span><span class="p">,</span> <span class="s1">&#39;marital-status&#39;</span><span class="p">,</span> <span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="s1">&#39;relationship&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">],</span>
    <span class="s2">&quot;workclass&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39; Private&#39;</span><span class="p">,</span> <span class="s1">&#39; Self-emp-inc&#39;</span><span class="p">,</span> <span class="s1">&#39; Self-emp-not-inc&#39;</span><span class="p">,</span> <span class="s1">&#39; State-gov&#39;</span><span class="p">,</span>
           <span class="s1">&#39; Federal-gov&#39;</span><span class="p">,</span> <span class="s1">&#39; Local-gov&#39;</span><span class="p">,</span> <span class="s1">&#39; ?&#39;</span><span class="p">,</span> <span class="s1">&#39; Without-pay&#39;</span><span class="p">,</span>
           <span class="s1">&#39; Never-worked&#39;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;education&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39; Assoc-acdm&#39;</span><span class="p">,</span> <span class="s1">&#39; Masters&#39;</span><span class="p">,</span> <span class="s1">&#39; HS-grad&#39;</span><span class="p">,</span> <span class="s1">&#39; Prof-school&#39;</span><span class="p">,</span> <span class="s1">&#39; 7th-8th&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Some-college&#39;</span><span class="p">,</span> <span class="s1">&#39; 11th&#39;</span><span class="p">,</span> <span class="s1">&#39; Bachelors&#39;</span><span class="p">,</span> <span class="s1">&#39; Assoc-voc&#39;</span><span class="p">,</span> <span class="s1">&#39; 10th&#39;</span><span class="p">,</span>
       <span class="s1">&#39; 9th&#39;</span><span class="p">,</span> <span class="s1">&#39; Doctorate&#39;</span><span class="p">,</span> <span class="s1">&#39; 12th&#39;</span><span class="p">,</span> <span class="s1">&#39; 1st-4th&#39;</span><span class="p">,</span> <span class="s1">&#39; 5th-6th&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Preschool&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;marital-status&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39; Married-civ-spouse&#39;</span><span class="p">,</span> <span class="s1">&#39; Divorced&#39;</span><span class="p">,</span> <span class="s1">&#39; Never-married&#39;</span><span class="p">,</span> <span class="s1">&#39; Widowed&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Married-spouse-absent&#39;</span><span class="p">,</span> <span class="s1">&#39; Separated&#39;</span><span class="p">,</span> <span class="s1">&#39; Married-AF-spouse&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;occupation&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s1">&#39; Exec-managerial&#39;</span><span class="p">,</span> <span class="s1">&#39; Prof-specialty&#39;</span><span class="p">,</span> <span class="s1">&#39; Other-service&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Handlers-cleaners&#39;</span><span class="p">,</span> <span class="s1">&#39; Craft-repair&#39;</span><span class="p">,</span> <span class="s1">&#39; Adm-clerical&#39;</span><span class="p">,</span> <span class="s1">&#39; Sales&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Machine-op-inspct&#39;</span><span class="p">,</span> <span class="s1">&#39; Transport-moving&#39;</span><span class="p">,</span> <span class="s1">&#39; ?&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Farming-fishing&#39;</span><span class="p">,</span> <span class="s1">&#39; Tech-support&#39;</span><span class="p">,</span> <span class="s1">&#39; Protective-serv&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Priv-house-serv&#39;</span><span class="p">,</span> <span class="s1">&#39; Armed-Forces&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;relationship&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39; Wife&#39;</span><span class="p">,</span> <span class="s1">&#39; Not-in-family&#39;</span><span class="p">,</span> <span class="s1">&#39; Unmarried&#39;</span><span class="p">,</span> <span class="s1">&#39; Husband&#39;</span><span class="p">,</span> <span class="s1">&#39; Own-child&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Other-relative&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;race&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39; White&#39;</span><span class="p">,</span> <span class="s1">&#39; Black&#39;</span><span class="p">,</span> <span class="s1">&#39; Asian-Pac-Islander&#39;</span><span class="p">,</span> <span class="s1">&#39; Amer-Indian-Eskimo&#39;</span><span class="p">,</span>
       <span class="s1">&#39; Other&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extractembeds" class="doc_header"><code>extractembeds</code><a href="https://github.com/manikyabard/transfertab/tree/master/transfertab/utils.py#L11" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extractembeds</code>(<strong><code>model</code></strong>, <strong><code>embeddinglg</code></strong>:<code>str</code>, <strong><code>metadict</code></strong>, <strong><code>path</code></strong>)</p>
</blockquote>

<pre><code>model: Any pytorch model, containing a layergroup with all the embedding layers.
embeddinglg: Name of the layer group containing the embedding layers.
metadict: A dictionary containing relevant metadata. Check the format given in docs for further details.
path: Path of the json</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">extractembeds</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;embeds&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;categories&#39;: [&#39;workclass&#39;,
  &#39;education&#39;,
  &#39;marital-status&#39;,
  &#39;occupation&#39;,
  &#39;relationship&#39;,
  &#39;race&#39;],
 &#39;workclass&#39;: {&#39;classes&#39;: [&#39;nan&#39;,
   &#39; Private&#39;,
   &#39; Self-emp-inc&#39;,
   &#39; Self-emp-not-inc&#39;,
   &#39; State-gov&#39;,
   &#39; Federal-gov&#39;,
   &#39; Local-gov&#39;,
   &#39; ?&#39;,
   &#39; Without-pay&#39;,
   &#39; Never-worked&#39;],
  &#39;embeddings&#39;: [[0.007202747277915478,
    -0.012875864282250404,
    -0.014799817465245724,
    0.003126859199255705,
    -0.006304586306214333,
    0.010779300704598427],
   [0.015383994206786156,
    0.013579949736595154,
    -0.0007835030555725098,
    0.0016431818949058652,
    0.0019429499516263604,
    0.0049425954930484295],
   [-0.0030373292975127697,
    -0.0014501578407362103,
    0.009285704232752323,
    -0.0018107056384906173,
    -0.0052525997161865234,
    0.018953772261738777],
   [0.0018311218591406941,
    0.004234636202454567,
    -0.003884845180436969,
    0.00023053947370499372,
    -0.008045045658946037,
    -0.0100539680570364],
   [0.0046618664637207985,
    -0.0060864705592393875,
    0.01193598285317421,
    0.002935742260888219,
    0.00939762219786644,
    0.0019358419813215733],
   [0.012924198992550373,
    -0.0026238528080284595,
    -0.011708511970937252,
    -0.007250783499330282,
    0.007642081938683987,
    -0.013362432830035686],
   [-1.0633068995957728e-05,
    -0.00803273357450962,
    0.014792594127357006,
    -0.011842411942780018,
    0.0032565391156822443,
    0.011605012230575085],
   [-0.00937610026448965,
    0.005960456095635891,
    0.0035737263970077038,
    0.0007714792154729366,
    -0.016524171456694603,
    0.0005603903555311263],
   [0.019803280010819435,
    -0.010782775469124317,
    0.0019014175049960613,
    -0.0014955318765714765,
    0.002710392465814948,
    0.0070242974907159805],
   [0.003267694963142276,
    0.0017817559419199824,
    -0.0023880715016275644,
    -0.018648484721779823,
    -0.011410042643547058,
    0.005733145866543055]]},
 &#39;marital-status&#39;: {&#39;classes&#39;: [&#39;nan&#39;,
   &#39; Married-civ-spouse&#39;,
   &#39; Divorced&#39;,
   &#39; Never-married&#39;,
   &#39; Widowed&#39;,
   &#39; Married-spouse-absent&#39;,
   &#39; Separated&#39;,
   &#39; Married-AF-spouse&#39;],
  &#39;embeddings&#39;: [[-6.671711162198335e-05,
    0.0016077145701274276,
    -0.0005350656574591994,
    -0.001623245538212359,
    0.0034922331105917692],
   [-0.007678908761590719,
    0.009793772362172604,
    0.009141962975263596,
    -0.003788084490224719,
    -0.004951174836605787],
   [0.005515181925147772,
    0.002294065896421671,
    0.010475780814886093,
    -0.011013052426278591,
    0.007228697184473276],
   [-0.005985996685922146,
    -0.014955067075788975,
    0.009181941859424114,
    -0.002527940785512328,
    0.008765792474150658],
   [0.009807324968278408,
    -0.005282004363834858,
    -0.009766473434865475,
    0.012266288511455059,
    -0.0073043787851929665],
   [0.016439108178019524,
    0.00178896717261523,
    0.007308098953217268,
    -0.0037246618885546923,
    -0.0055961403995752335],
   [-0.004045101813971996,
    -0.007775368634611368,
    0.0004958900972269475,
    -0.007005644496530294,
    0.007274815812706947],
   [-0.014866847544908524,
    0.0011215758277103305,
    0.006581200286746025,
    0.019124457612633705,
    0.006330067757517099]]},
 &#39;occupation&#39;: {&#39;classes&#39;: [&#39;nan&#39;,
   &#39; Exec-managerial&#39;,
   &#39; Prof-specialty&#39;,
   &#39; Other-service&#39;,
   &#39; Handlers-cleaners&#39;,
   &#39; Craft-repair&#39;,
   &#39; Adm-clerical&#39;,
   &#39; Sales&#39;,
   &#39; Machine-op-inspct&#39;,
   &#39; Transport-moving&#39;,
   &#39; ?&#39;,
   &#39; Farming-fishing&#39;,
   &#39; Tech-support&#39;,
   &#39; Protective-serv&#39;,
   &#39; Priv-house-serv&#39;,
   &#39; Armed-Forces&#39;],
  &#39;embeddings&#39;: [[0.008522439748048782,
    -0.007435410283505917,
    -0.001640933915041387,
    -0.0018066366901621222,
    4.1840498852252495e-06,
    -0.005436936393380165,
    -0.0004346320347394794,
    0.005627745762467384],
   [-0.0005893228226341307,
    -0.015033689327538013,
    -0.008566074073314667,
    0.00014646204363089055,
    -0.0036744107492268085,
    -0.001268227118998766,
    -0.007991650141775608,
    -0.003001925302669406],
   [-0.0042722481302917,
    0.007209251169115305,
    1.2822150893043727e-05,
    0.010050966404378414,
    0.0068413857370615005,
    -0.0015402589924633503,
    -0.0003111906407866627,
    0.013746174052357674],
   [0.006658375728875399,
    -8.657983562443405e-05,
    -0.0005528402398340404,
    -0.0013755291001871228,
    0.0016947851981967688,
    -1.3696201676793862e-05,
    -0.006422773934900761,
    7.371547690127045e-05],
   [0.004686214495450258,
    -0.0028099133633077145,
    -0.01427561603486538,
    0.004890833515673876,
    0.0009465439361520112,
    0.00018551110406406224,
    0.007550619542598724,
    0.012810802087187767],
   [-0.01803218014538288,
    0.002111168811097741,
    0.012266058474779129,
    0.012366541661322117,
    -0.001732138334773481,
    -0.017282534390687943,
    -0.003556411247700453,
    0.00689314492046833],
   [0.010763218626379967,
    -0.012002537958323956,
    0.0052928803488612175,
    0.010797850787639618,
    0.0048608374781906605,
    0.011691216379404068,
    -0.018417838960886,
    -0.00263816281221807],
   [0.010179998353123665,
    -0.004125647246837616,
    0.0064912037923932076,
    -5.3124029363971204e-05,
    0.007323795929551125,
    -0.0033652586862444878,
    0.015995463356375694,
    -0.0017065837746486068],
   [0.0005794846219941974,
    -0.0033083814196288586,
    -0.008780024014413357,
    0.016175372526049614,
    0.014337863773107529,
    0.010130154900252819,
    -0.003316155867651105,
    -0.002445545047521591],
   [0.0019598801154643297,
    0.004172633867710829,
    -0.0080192219465971,
    -0.0008250689134001732,
    0.006548908073455095,
    -0.007972954772412777,
    0.01380013395100832,
    -0.003836692776530981],
   [0.005548895336687565,
    -0.003436707193031907,
    -0.004592515993863344,
    -0.010143079794943333,
    -0.01055161003023386,
    -0.01303709577769041,
    -0.0029599370900541544,
    0.013162381015717983],
   [0.005093328654766083,
    0.008223053067922592,
    0.0006161530036479235,
    0.0012426208704710007,
    0.0026310812681913376,
    -0.014391389675438404,
    -0.01349380612373352,
    -0.017127977684140205],
   [0.011028819717466831,
    -0.0003184575471095741,
    0.0006182441138662398,
    -0.013957224786281586,
    0.006283462047576904,
    -0.0013608519220724702,
    -0.009209223091602325,
    -0.0068930648267269135],
   [-0.006531231105327606,
    -0.007226547226309776,
    0.0019253503996878862,
    -0.006236832123249769,
    -0.0051637012511491776,
    0.01472847443073988,
    0.008358092978596687,
    0.01105005107820034],
   [0.006910533178597689,
    0.01067786943167448,
    -0.008017114363610744,
    -0.018608367070555687,
    0.00840083323419094,
    0.007494987454265356,
    0.008695106022059917,
    0.0004872484423685819],
   [0.0014984445879235864,
    0.0006864129099994898,
    0.0013830411480739713,
    0.005648188292980194,
    0.008866947144269943,
    -0.005453021265566349,
    0.007302621379494667,
    0.007598549127578735]]},
 &#39;relationship&#39;: {&#39;classes&#39;: [&#39;nan&#39;,
   &#39; Wife&#39;,
   &#39; Not-in-family&#39;,
   &#39; Unmarried&#39;,
   &#39; Husband&#39;,
   &#39; Own-child&#39;,
   &#39; Other-relative&#39;],
  &#39;embeddings&#39;: [[0.013607945293188095,
    0.007826167158782482,
    -0.0006427312036976218,
    -0.005422067362815142,
    -0.005811530631035566],
   [0.001486390014179051,
    -0.004966237582266331,
    -0.008989010006189346,
    -0.004137700889259577,
    0.002081301063299179],
   [0.008745606057345867,
    0.009436423890292645,
    -0.008327503688633442,
    -0.00888767745345831,
    0.0015002114232629538],
   [9.087732178159058e-05,
    0.004242233000695705,
    0.017300711944699287,
    0.007085636258125305,
    0.011879299767315388],
   [0.0026011501904577017,
    0.010028519667685032,
    -0.009744442068040371,
    -0.0050666797906160355,
    -0.00911679770797491],
   [-0.002763936761766672,
    0.014043889008462429,
    0.012967361137270927,
    0.012324019335210323,
    -0.010058838874101639],
   [-0.005738790612667799,
    0.0027148425579071045,
    0.010668860748410225,
    -0.013016377575695515,
    -0.00037918685120530427]]},
 &#39;race&#39;: {&#39;classes&#39;: [&#39;nan&#39;,
   &#39; White&#39;,
   &#39; Black&#39;,
   &#39; Asian-Pac-Islander&#39;,
   &#39; Amer-Indian-Eskimo&#39;,
   &#39; Other&#39;],
  &#39;embeddings&#39;: [[0.009624673053622246,
    -0.005609381478279829,
    -0.006551929749548435,
    0.0034199540968984365],
   [0.010356235317885876,
    -0.002339851576834917,
    -0.005097548943012953,
    0.011707967147231102],
   [-0.002846286166459322,
    -0.01350429281592369,
    0.006363296415656805,
    -0.008238670416176319],
   [0.006458679214119911,
    0.00665827514603734,
    0.0016154462937265635,
    0.011574250645935535],
   [-0.0009584802901372313,
    -0.00035405970993451774,
    0.0007372238324023783,
    0.00480199558660388],
   [-0.003637610236182809,
    0.0036549961660057306,
    -0.011196732521057129,
    -0.006430203560739756]]}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

